# Дорасчет ежемесячных текущих показаний по счётчикам

## Как пользоваться проектом

1. Перейдите в папку dist и запустите main.exe
2. Результаты расчета будут сохранены в папке data в файле calculation_results.xlsx на листе calc. На листе add будет сохранена дополнительная информация косательно расчетов.
3. Если в процессе расчета будут возникать ошибки, отчеты по ним будут сохранены в папке logs.

## Настройки проекта:

В файле .env вы можете изменить AVG_EXP - средний расход по опоре (по умолчанию 1200). Для более детального вывода в консоль можете переключить режимы между DEBUG = True или False

## Алгоритмы дорасчета текущих показаний:

Для расчёта используется три файла, которые лежат в папке data:

A = "архив.xlsx"
B = "интегральные_показания.xlsx"
C  = "показания_за_период.xlsx"


Файл A нужен только для того, чтобы к данным из файла B по полю "Код ЭО" добавить "АСКУЭ", "Шифр опоры".

Расчёт текущих показаний производитс в следующем приоритете, если в файле C заполнены "действительно на1" и "действительно на2" и данные валидны:

1. Алгоритм base_algoritm - если сходится "Номер ПУ" и "Шифр опоры" из B с С тогда алгоритм следующий, а также заполнены "Показания на конец периода" в C:
   1.1. Если в столбце "действительно на1" указано первое число прошедшего месяца, а в "действительно на2" указано первое число нового месяца, тогда текущие показания расчитываем так:
   x = y
   где y - показания на конец периода из C
   2.2. Если в столбце "действительно на1" указано НЕ первое число прошедшего месяца или в "действительно на2" указано НЕ первое число нового месяца, тогда текущие показания:
   x = r * dt / n + y
   где r - расход из C, n - кол-во дней между промежутками (кол-во опрошенных дней), dt - количество дней в месяце минус n.

2. Алгоритм add_algoritm - если тип точки учета "Комерческая" (приоритет) или "Контрольная" тогда текущие показания расчитываем следующим образом:
   2.1. Если в столбце "действительно на1" указано первое число прошедшего месяца, а в "действительно на2" указано первое число нового месяца, тогда текущие показания расчитываем так:
   x = r + z
   где z - "Предыдущие показания" из B
   2.2. Если в столбце "действительно на1" указано НЕ первое число прошедшего месяца или в "действительно на2" указано НЕ первое число нового месяца, тогда текущие показания:
   x = r * dt / n + z

3. Алгоритм extra_algoritm:
   3.1. Если у опоры нет источника питания и она нигде не указана в качестве источника питания:
   x = a * AVG_EXP + z
   где a - количество "Групп операторов" ("Megafon", "MTS", "Tele2", "Vimpelcom")

   3.2. Если нет источника питания, но она для каких то других опор является источником питания (мастер опора), тогда:
   b = сумма а по каждой из этой группы опор где указанная опора является мастер опорой + сама опора
   x = b * AVG_EXP + z

   3.3. Если у опоры есть источник питания, тогда
   x = z

# calculating_of_meter_readings
Ежемесячный дорасчет показаний счетчиков TowerStore


## Подлезные команды

```bash
pyinstaller --onefile --icon=icon.ico --add-data "data;data" --add-data "logs;logs" main.py
```
| Создание исполняемого файла из python скрипта
